{"version":3,"sources":["utils/covid19DataProcessor.ts","utils/covid19API.ts","redux/sagas/index.ts","redux/reducers/covid19Reducer.ts","redux/reducers/index.ts","redux/index.js","i18n/locales/index.js","styles/App.js","styles/Main.js","styles/MapLegend.js","i18n/allMessages.ts","components/mapLegend/MapLegend.tsx","redux/selectors/index.ts","components/main/Main.tsx","App.tsx","AppIntlWrapper.tsx","styles/Index.js","serviceWorker.js","index.js"],"names":["buildCasesByProvinceAndDate","data","result","forEach","row","date","ine_code","name","province","accumulated","new_cases","dateMinus1","moment","subtract","format","currentAccumulated","parseInt","cases_accumulated","isNaN","fetchCovid19Data","Promise","resolve","reject","readRemoteFile","header","complete","results","lastUpdateDate","length","error","fetchCovidData","covid19DataSaga","call","covid19Data","put","type","payload","message","takeEvery","initialState","noDataProvinces","rootReducer","combineReducers","covid19","state","action","sagaMiddleware","createSagaMiddleware","composeEnhancers","window","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","createStore","applyMiddleware","run","covid19Sagas","en","es","AppWrapper","styled","div","MainWrapper","MapLegendWrapper","messages","defineMessages","title","id","defaultMessage","updateDate","provincePopup","noData","legendTitle","legendRed","legendYellow","legendGreen","legendBlack","dataSource","ColorLegend","className","text","MapLegend","intl","useIntl","formatMessage","a","msg","target","rel","href","getLastUpdateDate","getLast14ByProvice","lastDate","Object","keys","i","currentDate","buildLast14Days","getNoDataProvinces","SPAIN_PROVINCES","spainProvinces","LAT_LNG","getColor","provinceCode","cases","includes","Main","dispatch","useDispatch","useState","openLegend","setOpenLenged","last14ByProvince","useSelector","useEffect","closeLegend","isEmpty","isMobile","Map","center","zoom","onMove","onClick","onZoom","TileLayer","attribution","url","GeoJSON","style","feature","color","weight","fillOpacity","fillColor","properties","cartodb_id","onEachFeature","layer","bindPopup","List","withOrientationChange","isLandscape","Loop","AppIntlWrapper","locale","location","search","replace","translations","GlobalStyle","createGlobalStyle","Boolean","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","console"],"mappings":"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","file":"static/js/main.e271d1e5.chunk.js","sourcesContent":["import moment from \"moment\";\n\nimport {\n  CasesByProvince,\n  Last14DaysData,\n  CsvData,\n  AccumulatedByDate,\n} from \"../types/common.types\";\n\n/**\n * Build an object of this format:\n * {\n *   ine_code: {\n *     name: String,\n *     accumulated: Number,\n *   },\n *   ...\n * }\n * @param data Object from {@link buildCasesByProvinceDate} method.\n * @returns {Object}\n */\nexport const buildLast14Days = (data: CasesByProvince, lastDate: string) => {\n  const result: Last14DaysData = {};\n\n  for (let ine_code of Object.keys(data)) {\n    result[ine_code] = {\n      name: data[ine_code].name as string,\n      accumulated: 0,\n    };\n\n    // Accumulate last 15 days of new cases\n    for (let i = 0; i < 15; ++i) {\n      const currentDate = moment(lastDate)\n        .subtract(i, \"days\")\n        .format(\"YYYY-MM-DD\");\n      result[ine_code].accumulated += data[ine_code][currentDate]\n        ? (data[ine_code][currentDate] as AccumulatedByDate).new_cases\n        : 0;\n    }\n  }\n  return result;\n};\n\n/**\n * Return the last date in which the data was updated.\n * @param {Object} data\n * @returns {String} Date\n */\nexport const getLastUpdateDate = (data: CsvData) => {\n  if (!data.length) {\n    return \"\";\n  }\n  return data[data.length - 1].date || data[data.length - 2].date;\n};\n\n/**\n * Build an object of this format:\n * {\n *   ine_code: {\n *     name: String,\n *     date1: {\n *       accumulated: Number,\n *       new_cases: Number\n *     },\n *     date2: {\n *       accumulated: Number,\n *       new_cases: Number\n *     },\n *     ...\n *   }\n * }\n * @param data Object from readRemoteFile call.\n * @returns {Object}\n */\nexport const buildCasesByProvinceAndDate = (data: CsvData) => {\n  const result: CasesByProvince = {};\n\n  data.forEach((row) => {\n    if (row.date) {\n      if (!result[row.ine_code]) {\n        result[row.ine_code] = {\n          name: row.province,\n        };\n      }\n      result[row.ine_code][row.date] = {\n        accumulated: 0,\n        new_cases: 0,\n      };\n\n      const dateMinus1 = moment(row.date)\n        .subtract(1, \"days\")\n        .format(\"YYYY-MM-DD\");\n\n      // Some times, accumulated can be NA, let's grab the one from the previous\n      // day or 0 if it is the first day\n      let currentAccumulated = parseInt(row.cases_accumulated, 10);\n      if (isNaN(currentAccumulated)) {\n        currentAccumulated = result[row.ine_code][dateMinus1]\n          ? (result[row.ine_code][dateMinus1] as AccumulatedByDate)[\n              \"accumulated\"\n            ]\n          : 0;\n      }\n\n      (result[row.ine_code][\n        row.date\n      ] as AccumulatedByDate).accumulated = currentAccumulated;\n      // Calculate new cases by subtracting accumulated of the previous day\n      if (result[row.ine_code][dateMinus1]) {\n        // Current date - previous date\n        (result[row.ine_code][row.date] as AccumulatedByDate).new_cases =\n          currentAccumulated -\n          (result[row.ine_code][dateMinus1] as AccumulatedByDate).accumulated;\n      } else {\n        // First date\n        (result[row.ine_code][\n          row.date\n        ] as AccumulatedByDate).new_cases = currentAccumulated;\n      }\n    }\n  });\n  return result;\n};\n","import { readRemoteFile } from \"react-papaparse\";\nimport {\n  buildCasesByProvinceAndDate,\n  getLastUpdateDate,\n} from \"./covid19DataProcessor\";\n\nimport { CsvData } from \"../types/common.types\";\n\nconst DATA_URL =\n  \"https://raw.githubusercontent.com/montera34/escovid19data/master/data/output/covid19-provincias-spain_consolidated.csv\";\n\n/**\n * Fetch CSV data from repository and builds data for map.\n * @returns {Promise<Object>}\n */\nexport const fetchCovid19Data = () =>\n  new Promise((resolve, reject) => {\n    readRemoteFile(DATA_URL, {\n      header: true,\n      complete: (results: { data: CsvData }) =>\n        resolve({\n          data: buildCasesByProvinceAndDate(results.data),\n          lastUpdateDate: getLastUpdateDate(results.data),\n        }),\n      error: reject,\n    });\n  });\n","import { call, put, takeEvery } from \"redux-saga/effects\";\nimport { fetchCovid19Data } from \"../../utils/covid19API\";\n\nexport const FETCH_COVID19_DATA: string = \"FETCH_COVID19_DATA\";\nexport const FETCH_COVID19_SUCCESSFUL: string = \"FETCH_COVID19_SUCCESSFUL\";\nexport const FETCH_COVID19_FAILED: string = \"FETCH_COVID19_FAILED\";\n\nfunction* fetchCovidData() {\n  try {\n    const covid19Data = yield call(fetchCovid19Data);\n    yield put({\n      type: FETCH_COVID19_SUCCESSFUL,\n      payload: covid19Data,\n    });\n  } catch (e) {\n    yield put({ type: FETCH_COVID19_FAILED, payload: e.message });\n  }\n}\n\nfunction* covid19DataSaga() {\n  yield takeEvery(FETCH_COVID19_DATA, fetchCovidData);\n}\n\nexport default covid19DataSaga;\n","import { FETCH_COVID19_SUCCESSFUL, FETCH_COVID19_FAILED } from \"../sagas\";\nimport { Action } from \"../../types/common.types\";\n\nconst initialState = {\n  data: [],\n  lastUpdateDate: null,\n  noDataProvinces: [15, 27, 32, 36],\n};\n\nexport const covid19 = (state = initialState, action: Action) => {\n  switch (action.type) {\n    case FETCH_COVID19_SUCCESSFUL:\n      return { ...state, ...action.payload };\n    case FETCH_COVID19_FAILED:\n      return { ...state, data: {} };\n    default:\n      return state;\n  }\n};\n","import { combineReducers } from \"redux\";\nimport { covid19 } from \"./covid19Reducer\";\n\nexport const rootReducer = combineReducers({ covid19 });\n","import { createStore, applyMiddleware, compose } from \"redux\";\nimport createSagaMiddleware from \"redux-saga\";\n\nimport { rootReducer } from \"./reducers\";\nimport covid19Sagas from \"./sagas\";\n\n// create the saga middleware\nconst sagaMiddleware = createSagaMiddleware();\n\nconst composeEnhancers =\n  (typeof window !== \"undefined\" &&\n    window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__) ||\n  compose;\n\n// mount it on the Store\nexport const store = createStore(\n  rootReducer,\n  composeEnhancers(applyMiddleware(sagaMiddleware))\n);\n\n// then run the saga\nsagaMiddleware.run(covid19Sagas);\n","import en from './en.json';\nimport es from './es.json';\n\nexport default { en, es };\n","import styled from 'styled-components';\n\nexport const AppWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n\n  p {\n    margin: 0;\n  }\n\n  @keyframes rotating {\n    from {\n      transform: rotate(0deg);\n    }\n    to {\n      transform: rotate(360deg);\n    }\n  }\n\n  .loading {\n    animation: rotating 2s linear infinite;\n  }\n\n  .app-header {\n    background-color: #282c34;\n    height: 50px;\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    font-size: 14px;\n    color: white;\n\n    h1 {\n      margin: 0 auto;\n    }\n\n    h4 {\n      margin-left: 15px;\n    }\n\n    .loading {\n      margin-left: 20px;\n    }\n\n    #languages {\n      margin-left: auto;\n      a {\n        color: #fff;\n        margin-right: 12px;\n        text-decoration: none;\n        font-weight: bold;\n\n        &:hover {\n          text-decoration: underline;\n        }\n      }\n    }\n  }\n`;\n","import styled from 'styled-components';\n\nexport const MAP_RED = '#CC0000';\nexport const MAP_YELLOW = '#FFFF00';\nexport const MAP_GREEN = '#4C9900';\n\nexport const MainWrapper = styled.div`\n  flex: 1;\n\n  .leaflet-container {\n    height: 100%;\n  }\n\n  #map-legend-wrapper {\n    position: fixed;\n    right: 25px;\n    bottom: 25px;\n    z-index: 1000;\n  }\n\n  #menu-icon {\n    position: fixed;\n    right: 25px;\n    bottom: 25px;\n    z-index: 1000;\n    background-color: #eee;\n    box-shadow: 10px 10px 50px 10px rgba(0, 0, 0, 0.3);\n    padding: 15px;\n    border: 1px solid #bbb;\n    border-radius: 4px;\n    display: none;\n  }\n\n  &.mobile-layout {\n    #map-legend-wrapper:not(.show) {\n      display: none;\n    }\n\n    #menu-icon:not(.hide) {\n      display: block;\n    }\n  }\n`;\n","import styled from 'styled-components';\n\nimport { MAP_RED, MAP_YELLOW, MAP_GREEN } from './Main';\n\nexport const MapLegendWrapper = styled.div`\n  background-color: #eee;\n  box-shadow: 10px 10px 50px 10px rgba(0, 0, 0, 0.3);\n  padding: 15px;\n  border: 1px solid #bbb;\n  border-radius: 4px;\n  display: flex;\n  flex-direction: column;\n\n  p {\n    font-size: 14px;\n    margin-bottom: 15px;\n\n    &:last-child {\n      margin-bottom: 0;\n      font-size: 12px;\n    }\n  }\n\n  & > div {\n    display: flex;\n    flex-direction: row;\n    margin-bottom: 15px;\n    font-size: 12px;\n    align-items: center;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    .color-box {\n      width: 40px;\n      height: 25px;\n      border: 1px solid #bbb;\n      border-radius: 4px;\n      margin-right: 6px;\n      opacity: 0.7;\n\n      &.red {\n        background-color: ${MAP_RED};\n      }\n\n      &.yellow {\n        background-color: ${MAP_YELLOW};\n      }\n\n      &.green {\n        background-color: ${MAP_GREEN};\n      }\n\n      &.black {\n        background-color: #000;\n      }\n    }\n  }\n`;\n","import { defineMessages } from \"react-intl\";\n\nconst messages = defineMessages({\n  /**\n   * App.js\n   */\n  title: {\n    id: \"app.title\",\n    defaultMessage: \"Spain Covid-19\",\n  },\n  updateDate: {\n    id: \"app.updateDate\",\n    defaultMessage: \"Data last update date: {lastUpdateDate}\",\n  },\n\n  /**\n   * Main.js\n   */\n  provincePopup: {\n    id: \"main.provincePopup\",\n    defaultMessage:\n      \"Province: {name}<br />Accumulated cases in last 15 days: {accumulated}\",\n  },\n  noData: {\n    id: \"main.noData\",\n    defaultMessage: \"Province: {name}<br />,Data not available.\",\n  },\n\n  /**\n   * MapLegend.js\n   */\n  legendTitle: {\n    id: \"legend.title\",\n    defaultMessage: \"Last 14 days\",\n  },\n  legendRed: {\n    id: \"legend.red\",\n    defaultMessage: \"> 50 cases\",\n  },\n  legendYellow: {\n    id: \"legend.yellow\",\n    defaultMessage: \"< 50 cases\",\n  },\n  legendGreen: {\n    id: \"legend.green\",\n    defaultMessage: \"0 cases\",\n  },\n  legendBlack: {\n    id: \"legend.black\",\n    defaultMessage: \"Data not available\",\n  },\n  dataSource: {\n    id: \"legend.source\",\n    defaultMessage: \"Data source: <a>Escovid19data</a>\",\n  },\n});\n\nexport default messages;\n","import React from \"react\";\nimport { useIntl } from \"react-intl\";\n\nimport { MapLegendWrapper } from \"../../styles/MapLegend\";\nimport messages from \"../../i18n/allMessages\";\n\nimport { ColorLegendProps, MapLegendProps } from \"./mapLegend.types\";\n\nconst ColorLegend: React.FC<ColorLegendProps> = ({ className, text }) => {\n  return (\n    <div>\n      <div className={`color-box ${className}`}></div>\n      {text}\n    </div>\n  );\n};\n\nconst MapLegend: React.FC<MapLegendProps> = ({ className }) => {\n  const intl = useIntl();\n  return (\n    <MapLegendWrapper id=\"map-legend-wrapper\" className={className}>\n      <p>{intl.formatMessage(messages.legendTitle)}</p>\n      <ColorLegend\n        className=\"red\"\n        text={intl.formatMessage(messages.legendRed)}\n      />\n      <ColorLegend\n        className=\"yellow\"\n        text={intl.formatMessage(messages.legendYellow)}\n      />\n      <ColorLegend\n        className=\"green\"\n        text={intl.formatMessage(messages.legendGreen)}\n      />\n      <ColorLegend\n        className=\"black\"\n        text={intl.formatMessage(messages.legendBlack)}\n      />\n      <p>\n        {intl.formatMessage(messages.dataSource, {\n          a: (msg: String) => (\n            <a\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n              href=\"https://github.com/montera34/escovid19data\"\n            >\n              {msg}\n            </a>\n          ),\n        })}\n      </p>\n    </MapLegendWrapper>\n  );\n};\n\nexport default MapLegend;\n","import { RootState } from \"../../types/common.types\";\nimport { buildLast14Days } from \"../../utils/covid19DataProcessor\";\n\n/**\n * Selector to get last update date from redux store.\n * @param {Object} state\n */\nexport const getLastUpdateDate = (state: RootState) =>\n  state.covid19.lastUpdateDate;\n\n/**\n * Return data for last 14 days.\n * @param {Object} state\n */\nexport const getLast14ByProvice = (state: RootState) =>\n  buildLast14Days(state.covid19.data, state.covid19.lastUpdateDate);\n\n/**\n * Return list of provinces whose data is not available\n * @param {Object} state\n */\nexport const getNoDataProvinces = (state: RootState) =>\n  state.covid19.noDataProvinces;\n","import React, { useState, useEffect } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useIntl } from \"react-intl\";\nimport { Map, GeoJSON, TileLayer, Popup } from \"react-leaflet\";\n\nimport { LatLngExpression, Layer, StyleFunction } from \"leaflet\";\nimport { List } from \"@material-ui/icons\";\nimport { isMobile } from \"react-device-detect\";\n\nimport MapLegend from \"../mapLegend/MapLegend\";\nimport { MainWrapper, MAP_RED, MAP_YELLOW, MAP_GREEN } from \"../../styles/Main\";\nimport spainProvinces from \"../../data/spain-provinces.json\";\nimport { FETCH_COVID19_DATA } from \"../../redux/sagas\";\n\nimport { getLast14ByProvice, getNoDataProvinces } from \"../../redux/selectors\";\nimport messages from \"../../i18n/allMessages\";\n\nimport * as geojson from \"geojson\";\nimport { isEmpty } from \"lodash\";\n\nconst SPAIN_PROVINCES: GeoJSON.GeoJsonObject = spainProvinces as GeoJSON.GeoJsonObject;\nconst LAT_LNG: LatLngExpression = [37.485818, -5.877067];\nconst ZOOM = 5;\n\n/**\n * Return a color depending on the number of cases reported in the given province.\n * @param {Number} provinceCode\n * @param {Number} cases\n * @param {Array} noDataProvinces\n */\nconst getColor = (\n  provinceCode: number,\n  cases: number,\n  noDataProvinces: Array<number>\n) => {\n  if (noDataProvinces.includes(provinceCode)) {\n    return \"#000\";\n  }\n\n  if (cases >= 50) {\n    return MAP_RED;\n  } else if (cases > 0) {\n    return MAP_YELLOW;\n  }\n  return MAP_GREEN;\n};\n\n/**\n * Popup component for map. Render a message as the body of the popup.\n * @param {Object} props\n */\nconst MapPopup: React.FC = ({ children }) => (\n  <Popup>\n    <p>{children}</p>\n  </Popup>\n);\n\nconst Main = () => {\n  const intl = useIntl();\n  const dispatch = useDispatch();\n  const [openLegend, setOpenLenged] = useState(false);\n  const last14ByProvince = useSelector(getLast14ByProvice);\n  const noDataProvinces = useSelector(getNoDataProvinces);\n\n  /**\n   * Fetch data from server.\n   */\n  useEffect(() => {\n    dispatch({ type: FETCH_COVID19_DATA });\n  }, []);\n\n  /**\n   * Close legend when interacting with the map.\n   */\n  const closeLegend = () => {\n    setOpenLenged(false);\n  };\n\n  /**\n   * Return style object for each of the provinces.\n   * @param {Object} feature\n   */\n  const geoJSONStyle: StyleFunction = (feature) => {\n    return {\n      color: \"#1f2021\",\n      weight: 1,\n      fillOpacity: 0.5,\n      fillColor: getColor(\n        feature?.properties?.cartodb_id,\n        last14ByProvince[feature?.properties?.cartodb_id].accumulated,\n        noDataProvinces\n      ),\n    };\n  };\n\n  /**\n   * Create a popup to show the data for each province on click.\n   * @param {Object} feature\n   * @param {Object} layer\n   */\n  const onEachFeature = (feature: geojson.Feature, layer: Layer): void => {\n    const message = intl.formatMessage(\n      noDataProvinces.includes(feature.properties?.cartodb_id)\n        ? messages.noData\n        : messages.provincePopup,\n      last14ByProvince[feature.properties?.cartodb_id]\n    );\n    layer.bindPopup(`<MapPopup>${message}</MapPopup>`);\n  };\n\n  return !isEmpty(last14ByProvince) ? (\n    <MainWrapper className={isMobile ? \"mobile-layout\" : \"\"}>\n      <Map\n        center={LAT_LNG}\n        zoom={ZOOM}\n        onMove={closeLegend}\n        onClick={closeLegend}\n        onZoom={closeLegend}\n      >\n        <TileLayer\n          attribution='&amp;copy <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n          url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        />\n        <GeoJSON\n          data={SPAIN_PROVINCES}\n          style={geoJSONStyle}\n          onEachFeature={onEachFeature}\n        />\n      </Map>\n      <List\n        id=\"menu-icon\"\n        className={openLegend ? \"hide\" : \"\"}\n        onClick={() => setOpenLenged(true)}\n      ></List>\n      <MapLegend className={openLegend ? \"show\" : \"\"}></MapLegend>\n    </MainWrapper>\n  ) : null;\n};\n\nexport default Main;\n","import React from \"react\";\nimport { useSelector } from \"react-redux\";\nimport { useIntl } from \"react-intl\";\nimport moment from \"moment\";\nimport { AppWrapper } from \"./styles/App\";\nimport Main from \"./components/main/Main\";\nimport { Loop } from \"@material-ui/icons\";\nimport { isMobile, withOrientationChange } from \"react-device-detect\";\n\nimport { getLastUpdateDate } from \"./redux/selectors\";\n\nimport messages from \"./i18n/allMessages\";\n\nimport { AppProps } from \"./types/common.types\";\n\nconst App = ({ isLandscape }: AppProps) => {\n  const intl = useIntl();\n  const lastUpdateDate = useSelector(getLastUpdateDate);\n\n  return (\n    <AppWrapper>\n      <header className=\"app-header\">\n        {lastUpdateDate ? (\n          <h4>\n            {intl.formatMessage(messages.updateDate, {\n              lastUpdateDate: moment(lastUpdateDate).format(\"DD-MM-YYYY\"),\n            })}\n          </h4>\n        ) : (\n          <Loop className=\"loading\" />\n        )}\n        {(!isMobile || isLandscape) && (\n          <h1>{intl.formatMessage(messages.title)}</h1>\n        )}\n        <div id=\"languages\">\n          <a href=\"?locale=es\">Espa√±ol</a>\n          <a href=\"?locale=en\">English</a>\n        </div>\n      </header>\n      <Main />\n    </AppWrapper>\n  );\n};\n\nexport default withOrientationChange(App);\n","import React from \"react\";\nimport { IntlProvider } from \"react-intl\";\nimport translations from \"./i18n/locales\";\nimport App from \"./App\";\n\nimport { Locales } from \"./types/common.types\";\n\nconst AppIntlWrapper = () => {\n  const locale = window.location.search.replace(\"?locale=\", \"\") || \"es\";\n  const messages = translations[locale as Locales];\n\n  return (\n    <IntlProvider locale={locale} messages={messages}>\n      <App />\n    </IntlProvider>\n  );\n};\n\nexport default AppIntlWrapper;\n","import { createGlobalStyle } from 'styled-components';\n\nexport const GlobalStyle = createGlobalStyle`\n  body {\n    margin: 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }\n`;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport { store } from \"./redux\";\nimport AppIntlWrapper from \"./AppIntlWrapper\";\n\nimport { GlobalStyle } from \"./styles/Index.js\";\n\nimport * as serviceWorker from \"./serviceWorker\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <GlobalStyle />\n    <Provider store={store}>\n      <AppIntlWrapper />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}